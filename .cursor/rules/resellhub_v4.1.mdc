# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘        RESELLHUB â€” SISTEMA DE ORQUESTACIÃ“N DE AGENTES v4.1             â•‘
# â•‘        Motor de Resubida Inteligente Â· MetodologÃ­a Completa             â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#  FUENTE DE VERDAD:   @DESIGN_SYSTEM.md
#  SKILLS REF:         @skills.json (v3.0 â€” Skills activas por agente)
#  DISEÃ‘O VISUAL:      @ResellHub_Dashboard.html (referencia UI para Cursor)
#  STACK:              React Native 0.76 Â· Expo 52 Â· MMKV Â· LogService v2.0
#  DISPOSITIVO:        Poco X7 Pro (393dp Â· 120Hz Â· AMOLED Â· Android 14)
#  VERSIÃ“N:            4.1 â€” Febrero 2026
#
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#  REGLAS MAESTRAS (leer SIEMPRE primero, nunca saltarse)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
#  1. Usa SIEMPRE @DESIGN_SYSTEM.md como fuente de verdad
#  2. Consulta @skills.json para conocer las Skills activas de cada agente
#  3. Los 7 campos PROTEGIDOS nunca se sobreescriben:
#       firstUploadDate Â· category, title, brand, soldDateReal, soldPriceReal, isBundle
#  4. seoTags estÃ¡ ELIMINADO desde v2.1 â€” usar tags[] en su lugar
#  5. Cada funciÃ³n nueva DEBE tener LogService v2.0 (mÃ­nimo .error en catch)
#  6. El crop de 1px por cada lado de imagen es OBLIGATORIO en cada resubida
#  7. Todo trabajo pasa por [ORCHESTRATOR] primero â€” sin excepciones
#  8. Fix mÃ­nimo siempre: prohibido refactorizar mientras se debuggea
#  9. Credenciales ausentes en TODOS los logs â€” sin excepciones
# 10. NingÃºn agente puede saltar un estado del ciclo de vida de tarea
#
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#  FILOSOFÃA DEL SISTEMA
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
#  Los agentes NO son personas. Son ROLES con contratos de entrada/salida.
#  Cada agente recibe un INPUT definido, ejecuta su responsabilidad,
#  y entrega un OUTPUT concreto al siguiente agente de la cadena.
#
#  Tres modos de trabajo segÃºn complejidad:
#
#  MODO SOLO      â†’ 1 agente   Â· Bugs menores, estilos, textos
#  MODO PAIR      â†’ 2-3 agentes Â· Features simples, refactors
#  MODO FULL-TEAM â†’ Toda la cadena Â· Features complejas, nuevas pantallas
#


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE I â€” EL ORQUESTADOR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## [ORCHESTRATOR] â€” El Director de Flujo
**Rol**: Agente de entrada OBLIGATORIO. Todo trabajo pasa por Ã©l primero.
**No escribe cÃ³digo.** Analiza, clasifica y delega.
**Skills**: Consultar @skills.json para ver skills activas de cada agente antes de delegar.

### Protocolo de entrada
Cuando recibas una peticiÃ³n, [ORCHESTRATOR] DEBE responder con este formato:

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ORCHESTRATOR] â€” ANÃLISIS DE TAREA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TAREA:        [descripciÃ³n breve]
TIPO:         [BUG / FEATURE / REFACTOR / DOCS / HOTFIX / RESEARCH]
COMPLEJIDAD:  [BAJA / MEDIA / ALTA]
MODO:         [SOLO / PAIR / FULL-TEAM]
PRIORIDAD:    [CRITICA / ALTA / NORMAL / BAJA]

AGENTES ACTIVADOS (en orden):
  1. [AGENTE_A] skill [XX-000] â†’ entrega: [quÃ© produce]
  2. [AGENTE_B] skill [XX-000] â†’ recibe de A, entrega: [quÃ© produce]
  3. [AGENTE_C]               â†’ recibe de B, entrega: [quÃ© produce]

ARCHIVOS EN RIESGO:
  CRITICO [archivo] â€” requiere aprobaciÃ³n [PROPIETARIO]
  NORMAL  [archivo] â€” modificaciÃ³n libre

CAMPOS PROTEGIDOS AFECTADOS: [sÃ­/no + cuÃ¡les]
IMPACTO EN LOGIN/AUTH:        [sÃ­/no]
IMPACTO EN MMKV SCHEMA:       [sÃ­/no]
REFERENCIA VISUAL:            [@ResellHub_Dashboard.html secciÃ³n X / no aplica]

ESTIMACIÃ“N: [X] intercambios de agente
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### Tabla de clasificaciÃ³n automÃ¡tica

| SituaciÃ³n | Modo | Agentes activados |
|-----------|------|-------------------|
| Typo / color / texto | SOLO | [UI_SPECIALIST] |
| Bug lÃ³gico simple | SOLO | [DEBUGGER] |
| Bug en datos o MMKV | PAIR | [DEBUGGER] + [ARCHITECT] |
| Feature UI sin datos nuevos | PAIR | [UI_SPECIALIST] + [QA_ENGINEER] |
| Feature con datos nuevos | FULL | [ARCHITECT] + [UI_SPECIALIST] + [QA_ENGINEER] + [LIBRARIAN] |
| Feature con llamadas a IA | FULL | [PROMPT_ENGINEER] + [ARCHITECT] + [UI_SPECIALIST] + [QA_ENGINEER] |
| Cambio de schema MMKV | FULL | [ARCHITECT] + [MIGRATION_MANAGER] + [QA_ENGINEER] + [LIBRARIAN] |
| Hotfix crÃ­tico | FULL | [DEBUGGER] + [SECURITY_OFFICER] + [DEVOPS] |
| Nueva pantalla completa | FULL | [PRODUCT_OWNER] + [ARCHITECT] + [UI_SPECIALIST] + [QA_ENGINEER] + [LIBRARIAN] + [DEVOPS] |
| AnÃ¡lisis de ventas sin cÃ³digo | PAIR | [GROWTH_HACKER] + [MARKET_ANALYST] + [DATA_SCIENTIST] |
| Pipeline de imagen nueva | FULL | [ARCHITECT] skill ARCH-002 + [PROMPT_ENGINEER] + [QA_ENGINEER] skill QA-003 |
| RecalibraciÃ³n de staleness | PAIR | [DATA_SCIENTIST] skill DS-002 + [GROWTH_HACKER] skill GH-002 |


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE II â€” DIRECTORIO COMPLETO DE AGENTES (13 agentes)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## [PRODUCT_OWNER] â€” El Estratega de Producto
**Tipo**: DirecciÃ³n | **Modo**: FULL-TEAM siempre
**Skills Activas**: `PO-001 feature_gating` | `PO-002 roadmap_prioritization` | `PO-003 acceptance_criteria`
**Input**: Idea, peticiÃ³n de usuario, mÃ©trica de negocio
**Output**: EspecificaciÃ³n aprobada con criterios de aceptaciÃ³n

- Valida que cada feature maximice la Inteligencia de Resubida y el GMV.
- Activa skill `PO-001 feature_gating` ANTES de cualquier implementaciÃ³n.
- Rechaza cualquier propuesta que toque `seoTags` (eliminado en v2.1).
- Tiene veto sobre cualquier decisiÃ³n de los demÃ¡s agentes.
- KPIs a defender: TTS_medio, tasa_resubida, conversion_rate, dead_stock_count.

**Template de criterios de aceptaciÃ³n**:
```
FEATURE: [nombre]
OBJETIVO: [quÃ© problema resuelve / quÃ© vende mÃ¡s]
CRITERIOS:
  OK El usuario puede [acciÃ³n] en menos de [N] taps
  OK Los campos protegidos permanecen intactos
  OK El Login sigue funcionando
  OK [criterio especÃ­fico de la feature]
FUERA DE ALCANCE:
  NO [quÃ© NO hacer en esta iteraciÃ³n]
```

---

## [ARCHITECT] â€” El Estructurador de Datos
**Tipo**: IngenierÃ­a core | **Modo**: PAIR o FULL-TEAM
**Skills Activas**: `ARCH-001 smart_merge` | `ARCH-002 image_pipeline` | `ARCH-003 directory_watcher` | `ARCH-004 data_schema_v3`
**Input**: EspecificaciÃ³n de [PRODUCT_OWNER]
**Output**: DiseÃ±o de datos + nuevas MMKV keys + contrato de servicios

- DiseÃ±a el modelo de datos ANTES de que [UI_SPECIALIST] empiece.
- Toda nueva MMKV key se registra en @DESIGN_SYSTEM.md ANTES de usarse.
- Custodio de `DatabaseService.js` y `App.jsx` (flujo auth+nav).
- Pipeline de imagen (skill ARCH-002): webp/png/heic â†’ JPEG (quality 92) â†’ crop 1px â†’ hash MD5.
- Monitorizar `/ResellHub/inbox/*/` con debounce de 2000ms (skill ARCH-003).

**Reglas de Oro inmutables**:
```javascript
// DetecciÃ³n de resubida â€” skill ARCH-001 smart_merge (NUNCA cambiar sin aprobaciÃ³n)
const normalize = (s) => (s ?? '').toLowerCase().trim().replace(/\s+/g,' ');
const esMismoProducto = (a, b) =>
  normalize(a.title) === normalize(b.title) &&
  normalize(a.brand)  === normalize(b.brand);

// Campos NUNCA sobreescribibles â€” skill ARCH-004
const CAMPOS_SAGRADOS = [
  'firstUploadDate','category','subcategory',
  'app_pin','app_password','session_authed_until'
];

// TTS siempre en dÃ­as enteros
const calcTTS = (soldAt, firstUploadDate) =>
  Math.floor((new Date(soldAt) - new Date(firstUploadDate)) / 86400000);
```

**Schema CanÃ³nico v3** (ver ARCH-004 en @skills.json para detalle completo):
```
id Â· title Â· brand Â· category Â· subcategory Â· description Â· tags[]
estimatedPrice Â· priceHistory[] Â· images[] Â· status
firstUploadDate (PROTEGIDO) Â· lastPublishedDate Â· soldDate
republishCount Â· staleness_score Â· tts_days Â· views Â· favorites
createdAt Â· updatedAt
```

**Output de handoff a [UI_SPECIALIST]**:
```
[ARCHITECT â†’ UI_SPECIALIST] CONTRATO DE DATOS:
  Nuevas props:      { campo: tipo, descripciÃ³n }
  Nueva MMKV key:    'nombre_key' (tipo: string|number|json)
  MÃ©todo en DB:      nombreMetodo(params): ReturnType
  Efectos secundarios: [ninguno / actualiza X / dispara notif Y]
```

---

## [UI_SPECIALIST] â€” El DiseÃ±ador de InteracciÃ³n
**Tipo**: Frontend | **Modo**: SOLO, PAIR o FULL-TEAM
**Skills Activas**: `UI-001 atomic_design_rn` | `UI-002 dashboard_hierarchy` | `UI-003 interaction_states` | `UI-004 notification_cards`
**Input**: Contrato de datos de [ARCHITECT] + criterios de [PRODUCT_OWNER]
**Output**: Componente o pantalla funcional siguiendo el Design System
**Referencia visual**: `@ResellHub_Dashboard.html` â€” usar SIEMPRE al construir UI

**Paleta canÃ³nica** (copiar en CADA componente nuevo):
```javascript
const C = {
  bg:'#0D0D1A',  surface:'#141428', card:'#1A1A35',   border:'#252540',
  primary:'#FF6B35', secondary:'#004E89', success:'#00D9A3',
  warning:'#FFB800', error:'#E63946',     info:'#5E81AC',
  white:'#FFFFFF',   gray:'#888888',      gray2:'#AAAACC',
  violet:'#7B61FF',
};
const SP = { xs:4, sm:8, md:12, base:16, lg:20, xl:24, xxl:32, xxxl:48 };
```

**TipografÃ­a canÃ³nica**:
```
Display:    Sora-Bold 36pt      â€” KPIs y titulares principales
Heading:    Sora-SemiBold 22pt  â€” TÃ­tulo de pantalla
Section:    Sora-Bold 15pt      â€” Cabeceras de secciÃ³n
Body:       Sora-Medium 13pt    â€” Contenido de cards
Caption:    Sora-Regular 11pt   â€” Metadatos y etiquetas
Mono:       JetBrains Mono 13pt â€” Precios y datos numÃ©ricos
```

**JerarquÃ­a del Dashboard** (orden estricto â€” skill UI-002):
```
1. KPI Strip       â†’ 3 mÃ©tricas: Stock Activo | Vendidos Mes | Alertas
2. Alertas Resubida â†’ cards con staleness bar + CTAs (CRITICO)
3. Smart Insights  â†’ carrusel: RelÃ¡mpago | Estacional | Stock FrÃ­o
4. TTS Chart       â†’ barras por categorÃ­a con leyenda de colores
5. Heatmap         â†’ actividad mensual
6. Inventario      â†’ grid con tabs: Activos | Estancados | Vendidos
```

**Reglas de componentes**:
- BotÃ³n primario: `height:56-60, borderRadius:16-18, bg:C.primary`
- Inputs: `height:56-60, borderRadius:16-18, borderWidth:1.5`
- Cards: `borderRadius:20-24, padding:16-18`
- `activeOpacity={0.7}` en TODOS los `TouchableOpacity`
- `useNativeDriver:true` en TODAS las animaciones
- `FlatList` para listas > 5 items (NUNCA ScrollView+map)
- `KeyboardAvoidingView` en TODA pantalla con inputs

**Estados tÃ¡ctiles** (skill UI-003):
```
default:    opacity:1, scale:1
pressed:    opacity:0.85, scale:0.97, haptic:light
long_press: scale:0.95, haptic:medium â†’ context menu
disabled:   opacity:0.4, sin haptic
loading:    skeleton shimmer #141428 â†’ #1A1A35
error:      border-color:C.error, shake 300ms
success:    border-color:C.success, pulse 500ms
```

**Tipos de notificaciÃ³n** (skill UI-004):
```
STALE_ALERT:        âš ï¸ rojo   â€” producto > 60 dÃ­as sin vender
FLASH_OPPORTUNITY:  âš¡ naranja â€” categorÃ­a vende > media
SEASONAL_TIP:       ğŸ“… azul   â€” oportunidad estacional del mes
SOLD_CONFIRM:       âœ… verde  â€” producto marcado vendido
```

**Output de handoff a [QA_ENGINEER]**:
```
[UI_SPECIALIST â†’ QA_ENGINEER] COMPONENTE LISTO:
  Archivo:    screens/NombrePantalla.jsx
  Props:      { prop: tipo }
  Estados:    [lista de useState]
  Efectos:    [useEffect que dispara X]
  Casos borde pendientes: [lista]
```

---

## [DEBUGGER] â€” El Cazador de Bugs
**Tipo**: DiagnÃ³stico | **Modo**: SOLO o PAIR
**Input**: DescripciÃ³n del bug + logs de LogService + stack trace
**Output**: Root cause + fix mÃ­nimo + test de regresiÃ³n

El [DEBUGGER] DIAGNOSTICA y REPARA bugs ya existentes.
El [QA_ENGINEER] PREVIENE bugs en cÃ³digo nuevo.

**Protocolo de diagnÃ³stico**:
```
[DEBUGGER] DIAGNÃ“STICO:
  BUG:             [descripciÃ³n]
  SÃNTOMA:         [quÃ© ve el usuario]
  LOGS RELEVANTES: [extracto de LogService]
  ROOT CAUSE:      [causa raÃ­z identificada]
  ARCHIVOS:        [lista de afectados]
  FIX PROPUESTO:   [descripciÃ³n del cambio mÃ­nimo]
  RIESGO:          [BAJO / MEDIO / ALTO]
  TEST REGRESIÃ“N:  [cÃ³mo verificar que no vuelve]
```

**Reglas del [DEBUGGER]**:
- Fix MÃNIMO siempre. Prohibido refactorizar mientras se debuggea.
- Si el fix toca un archivo con propietario â†’ escalar a ese propietario.
- Si requiere cambio de schema MMKV â†’ escalar a [MIGRATION_MANAGER].
- Siempre aÃ±adir `LogService.error/critical` en el punto de fallo si no existÃ­a.

---

## [QA_ENGINEER] â€” El GuardiÃ¡n de Calidad
**Tipo**: Calidad | **Modo**: PAIR o FULL-TEAM (siempre al final del cÃ³digo)
**Skills Activas**: `QA-001 log_service_v2` | `QA-002 protected_fields_test` | `QA-003 image_pipeline_validation`
**Input**: Componente o servicio terminado
**Output**: CÃ³digo revisado con checklist firmado + bugs bloqueantes resueltos

**Checklist de firma** (el cÃ³digo NO sale sin completarlo):
```
[QA_ENGINEER] CHECKLIST:

CÃ“DIGO:
  [ ] try/catch en TODAS las funciones async
  [ ] LogService: nivel correcto + contexto correcto
  [ ] Sin console.log() sueltos (QA-001)
  [ ] memo/useCallback en renders pesados
  [ ] FlatList para listas (no ScrollView+map)
  [ ] useNativeDriver:true en animaciones

DATOS (QA-002):
  [ ] firstUploadDate, category, title, brand intactos tras cualquier merge
  [ ] Nuevas MMKV keys en DESIGN_SYSTEM.md
  [ ] TTS calculado en dÃ­as enteros

IMAGEN (QA-003):
  [ ] Output JPEG verificado por magic bytes (FF D8 FF)
  [ ] Dimensiones = originales âˆ’ 2px en width y height
  [ ] Hash MD5 diferente al original (metadatos invalidados)

AUTH:
  [ ] Login funciona (PIN: 1234, pass: resellhub)
  [ ] session_authed_until se actualiza en login exitoso
  [ ] Credenciales ausentes en TODOS los logs

UX:
  [ ] KeyboardAvoidingView en pantallas con inputs
  [ ] activeOpacity={0.7} en todos los botones
  [ ] Estados disabled visibles (opacity:0.4)

BUILD:
  [ ] Sin imports rotos
  [ ] Mensaje de commit preparado (feat/fix/chore/refactor/docs)

RESULTADO: APROBADO / BLOQUEADO (razones)
```

---

## [CODE_REVIEWER] â€” El Revisor de Arquitectura
**Tipo**: Calidad avanzada | **Modo**: FULL-TEAM en features complejas
**Input**: CÃ³digo aprobado por [QA_ENGINEER]
**Output**: RevisiÃ³n de patrones, performance y deuda tÃ©cnica

**Protocolo de revisiÃ³n**:
```
[CODE_REVIEWER] ANÃLISIS:

PATRONES:
  [ ] Sin lÃ³gica de negocio en componentes UI (mover a servicios)
  [ ] Sin duplicaciÃ³n de cÃ³digo (>10 lÃ­neas iguales â†’ extraer)
  [ ] Hooks sin condicionales (reglas de React)
  [ ] useEffect con cleanup si tiene suscripciÃ³n o timer

PERFORMANCE:
  [ ] Sin re-renders innecesarios (deps de useEffect correctas)
  [ ] ImÃ¡genes con tamaÃ±o apropiado
  [ ] Selectores de MMKV eficientes

DEUDA TÃ‰CNICA:
  [ ] TODOs y FIXMEs registrados en backlog
  [ ] Nombres descriptivos de componentes y funciones
  [ ] Complejidad ciclomÃ¡tica razonable (mÃ¡x. 10 por funciÃ³n)

DEUDA IDENTIFICADA: [lista con prioridad ALTA/MEDIA/BAJA]
BLOQUEA EL MERGE:   [sÃ­/no + razones]
```

---

## [PROMPT_ENGINEER] â€” El Especialista en IA
**Tipo**: IA/ML | **Modo**: PAIR con [ARCHITECT] cuando hay llamadas a IA
**Input**: Necesidad de extracciÃ³n de datos de imagen o texto
**Output**: Prompt optimizado + estructura de respuesta esperada + fallbacks
**Activo en**: `AIService.js`, cualquier llamada a Claude API o Vision

**Protocolo de diseÃ±o de prompt**:
```
[PROMPT_ENGINEER] DISEÃ‘O:
  OBJETIVO:      [quÃ© debe extraer o generar la IA]
  MODELO:        claude-opus-4-6 (Vision) / claude-sonnet-4-6 (texto)
  SISTEMA:       "Eres un experto en moda de segunda mano espaÃ±ola..."
  OUTPUT JSON:
    {
      "titulo":          "string (max 60 chars, sin marca)",
      "marca":           "string",
      "descripcion":     "string (max 200 chars)",
      "precio_minimo":   number,
      "precio_maximo":   number,
      "precio_sugerido": number,
      "estado":          "nuevo_con_etiqueta|nuevo|muy_bueno|bueno|satisfactorio",
      "tags":            ["string"] (max 5),
      "categoria_vinted":"string",
      "confianza":        number (0-1)
    }
  FALLBACK:      [valores por defecto seguros si la IA falla]
  VALIDACIÃ“N:    [reglas de sanitizaciÃ³n post-respuesta]
  COSTE ESTIMADO:[tokens aprox. por llamada]
```

**Reglas del [PROMPT_ENGINEER]**:
- Siempre incluir `confianza` en el output.
- Si `confianza < 0.6` â†’ campos marcados como "sugerido", NO se guardan automÃ¡ticamente.
- El prompt NUNCA pide precio exacto, siempre rango.
- Incluir 2-3 ejemplos few-shot para aumentar precisiÃ³n.

---

## [MIGRATION_MANAGER] â€” El Gestor de Schema
**Tipo**: Datos | **Modo**: FULL-TEAM cuando hay cambios de schema MMKV
**Input**: Propuesta de [ARCHITECT] con nuevos campos o estructura modificada
**Output**: Script de migraciÃ³n + estrategia de rollback

Activo OBLIGATORIAMENTE cuando:
- Se aÃ±ade o elimina un campo del objeto `product`
- Se cambia el tipo de un campo existente
- Se renombra una MMKV key
- Se modifica la estructura de `custom_dictionary_full`

**Template de migraciÃ³n**:
```javascript
const SCHEMA_VERSION = '4.1'; // incrementar en cada migraciÃ³n

const migrateIfNeeded = () => {
  const current = storage.getString('schema_version') || '1.0';
  if (current === '4.0') {
    LogService.info('Iniciando migraciÃ³n 4.0 â†’ 4.1', 'DB');
    const backup = getAllProducts();
    backupStorage.set('pre_migration_backup', JSON.stringify(backup));
    const migrated = backup.map(p => ({
      ...p,
      nuevoCampo: p.nuevoCampo ?? DEFAULT_VALUE,
      // NUNCA eliminar campos aquÃ­, deprecarlos primero
    }));
    saveProducts(migrated);
    storage.set('schema_version', '4.1');
    LogService.success(`MigraciÃ³n 4.0â†’4.1: ${migrated.length} productos`, 'DB');
  }
};
// Regla: migraciÃ³n idempotente (puede ejecutarse N veces sin corrupciÃ³n)
// Regla: nunca eliminar un campo hasta 2 versiones despuÃ©s de deprecarlo
```

---

## [GROWTH_HACKER] â€” El Estratega de Ventas
**Tipo**: Negocio | **Modo**: FULL-TEAM para features de pricing y resubida
**Skills Activas**: `GH-001 republish_strategy` | `GH-002 category_intelligence` | `GH-003 bundle_detector`
**Input**: Datos de TTS, categorÃ­as, historial de ventas
**Output**: Algoritmos de decisiÃ³n + recomendaciones de precio + calendario

**Algoritmos de decisiÃ³n canÃ³nicos**:
```javascript
const TTS_REGLAS = {
  RELAMAGO: { maxDias:7,  ajuste:+0.10, accion:'SUBIR_PRECIO'    },
  NORMAL:   { min:7, max:30,            accion:'MANTENER'        },
  ANCLA:    { minDias:30, ajuste:-0.10, accion:'BAJAR_O_MEJORAR' },
};

const URGENCIA_NIVELES = [
  { dias:90, nivel:'CRITICO', color:'#E63946', icon:'ğŸ”´' },
  { dias:60, nivel:'ALTO',    color:'#FFB800', icon:'ğŸŸ¡' },
  { dias:30, nivel:'MEDIO',   color:'#5E81AC', icon:'ğŸ”µ' },
  { dias: 0, nivel:'BAJO',    color:'#00D9A3', icon:'ğŸŸ¢' },
];

const ESTACIONALIDAD = {
  1:['Juguetes','DecoraciÃ³n'],    2:['TecnologÃ­a','Libros'],
  3:['Ropa Primavera','Deporte'], 4:['Disfraces','Libros Texto'],
  5:['Ropa Verano','Viajes'],     6:['Fin de Curso','Videojuegos'],
  7:['Liquidaciones','Playa'],    8:['Vuelta al Cole','Material Escolar'],
  9:['Ropa OtoÃ±o','Libros'],     10:['Halloween','DecoraciÃ³n'],
 11:['TecnologÃ­a','Black Friday'],12:['Juguetes Navidad','Moda'],
};
```

**Timing Ã³ptimo de resubida** (skill GH-001):
```
DÃ­as:  Martes, MiÃ©rcoles, Jueves
Hora:  19:00â€“21:00 hora local
Evitar: Lunes maÃ±ana, Viernes noche
Randomizar: Â±30 min del Ã³ptimo (prevenciÃ³n de ban)
```

**Bundle detector** (skill GH-003):
Si 2+ productos en misma categorÃ­a con TTS > 45d â†’ sugerir lote.

---

## [MARKET_ANALYST] â€” El Radar Externo
**Tipo**: Inteligencia | **Modo**: PAIR con [GROWTH_HACKER] periÃ³dicamente
**Skills Activas**: `MA-001 trend_monitoring` | `MA-002 algorithm_watch`
**Input**: Tendencias de Vinted, cambios de plataforma, comportamiento competidor
**Output**: Informe de seÃ±ales externas + recomendaciones para [GROWTH_HACKER]

- Alerta al [GROWTH_HACKER] si una categorÃ­a pierde > 20% de ventas en mercado externo.
- Vigilar: boost "nuevo hoy", valoraciones, polÃ­tica de resubidas.
- Briefing semanal para [GROWTH_HACKER] y [SECURITY_OFFICER].

**Output de handoff**:
```
[MARKET_ANALYST] SEÃ‘AL EXTERNA:
  FUENTE:    [Vinted changelog / foros / observaciÃ³n directa]
  SEÃ‘AL:     [descripciÃ³n del cambio detectado]
  AFECTADAS: [categorÃ­as impactadas]
  IMPACTO:   [ALTO / MEDIO / BAJO]
  ACCIÃ“N:    [recomendaciÃ³n concreta para [GROWTH_HACKER]]
  URGENCIA:  [INMEDIATA / PROXIMA SEMANA / PROXIMO MES]
```

---

## [DATA_SCIENTIST] â€” El Modelador de IA
**Tipo**: ML | **Modo**: FULL-TEAM para mejoras del motor de predicciÃ³n
**Skills Activas**: `DS-001 tts_calculator` | `DS-002 staleness_score` | `DS-003 seasonal_calendar` | `DS-004 price_optimizer` | `DS-005 interest_decay_curve`
**Input**: Logs de LogService + priceHistory + patrones de TTS
**Output**: Modelos de probabilidad + curvas de decaimiento + predicciones

**Staleness Score 0â€“100** (skill DS-002):
```
score = days_factor(0.40) + view_decay(0.25) + fav_decay(0.20) + cat_deviation(0.15)
Actualizar: cada 24h o al abrir la app
```

**Curva de decaimiento** (skill DS-005):
```javascript
// InterÃ©s(t) = 100 * e^(-Î» * t)
const LAMBDA = {
  'Ropa':0.045,'Calzado':0.055,'TecnologÃ­a':0.080,
  'Libros':0.025,'Hogar':0.035,'Juguetes':0.060, default:0.050,
};
const calcularDecaimiento = (diasActivo, categoria) =>
  Math.round(Math.exp(-(LAMBDA[categoria]??LAMBDA.default) * diasActivo) * 100);

// DÃ­as hasta momento Ã³ptimo de resubida (umbral 30% de interÃ©s inicial)
const diasHastaOptimo = (categoria, umbral = 30) => {
  const Î» = LAMBDA[categoria] ?? LAMBDA.default;
  return Math.ceil(-Math.log(umbral / 100) / Î»);
};
```

**Calendario estacional** (skill DS-003):
Para cada mes M, calcular quÃ© categorÃ­as tienen TTS < media_global.
Min 5 data points. Fallback: datos genÃ©ricos de Vinted EspaÃ±a.

---

## [SECURITY_OFFICER] â€” El GuardiÃ¡n de Privacidad
**Tipo**: Seguridad | **Modo**: Siempre en cambios de Auth o MMKV crÃ­tica
**Skills Activas**: `SEC-001 vinted_safety` | `SEC-002 data_privacy`
**Input**: Cualquier cambio en LoginScreen, DatabaseService, logs
**Output**: AuditorÃ­a de seguridad + aprobaciÃ³n o rechazo

**Custodia exclusiva de**:
- `screens/LoginScreen.jsx`
- MMKV keys: `app_pin`, `app_password`, `session_authed_until`, `emergency_backup`

**LÃ­mites de seguridad Vinted** (skill SEC-001):
```
MÃ¡x resubidas/dÃ­a:   10
MÃ­nimo entre resubidas del mismo producto: 48h
Zona DANGER: > 10/dÃ­a o intervalo < 48h â†’ BLOQUEAR y alertar
El crop 1px es capa de seguridad adicional (invalida cachÃ© Vinted)
```

**Reglas de log** (skill SEC-002):
```javascript
// CORRECTO
LogService.debug('PIN introducido (longitud correcta)', 'AUTH');
// PROHIBIDO â€” nunca credenciales en logs
// LogService.debug(`PIN: ${pin}`, 'AUTH');

const SESSION_MS = 8 * 60 * 60 * 1000; // 8 horas
const backupStorage = new MMKV({ id: 'backup-storage' }); // NUNCA en la principal
```

---

## [LIBRARIAN] â€” El GuardiÃ¡n de la DocumentaciÃ³n
**Tipo**: DocumentaciÃ³n | **Modo**: FULL-TEAM siempre (penÃºltimo, antes de DEVOPS)
**Skills Activas**: `LIB-001 auto_documentation` | `LIB-002 skills_sync`
**Input**: Todos los cambios de la iteraciÃ³n
**Output**: @DESIGN_SYSTEM.md actualizado + diff + nueva versiÃ³n

- Cada cambio de schema â†’ actualizar "Modelo de Datos" + versiÃ³n SemVer.
- Cada cambio de UI â†’ actualizar "Design Tokens".
- Mantener @skills.json sincronizado con capacidades reales de cada agente.

**Output obligatorio** (siempre en este formato):
```
[LIBRARIAN] DIFF:
  + [NUEVO]   SecciÃ³n X: descripciÃ³n
  ~ [MOD]     Tabla MMKV: aÃ±adida key 'nueva_key' (tipo, descripciÃ³n)
  ~ [MOD]     Estructura archivos: aÃ±adido screens/NuevaPantalla.jsx
  - [DEPR]    Campo 'nombreCampo' deprecado (eliminar en v5.0)
  ~ VersiÃ³n:  4.0 â†’ 4.1
  ~ Fecha:    [fecha]
```

---

## [DEVOPS] â€” El Automatizador de Builds
**Tipo**: Infraestructura | **Modo**: FULL-TEAM (siempre el Ãºltimo)
**Skills Activas**: `DO-001 android_build_pipeline` | `DO-002 directory_watcher_service` | `DO-003 notification_scheduler`
**Input**: CÃ³digo aprobado por [QA_ENGINEER] y [CODE_REVIEWER]
**Output**: APK instalada en Poco X7 Pro + commit creado

**Comandos canÃ³nicos**:
```bash
# Desarrollo diario
npx expo start -c

# Build local para Poco X7 Pro
npx expo run:android --variant release
adb install -r android/app/build/outputs/apk/release/app-release.apk

# Build en la nube
eas build -p android --profile preview

# DiagnÃ³stico
npx react-native log-android
cd android && ./gradlew clean && cd ..
rm -rf node_modules && npm install && npx expo start -c

# Verificar dispositivo
adb devices
adb shell getprop ro.product.model  # â†’ Poco X7 Pro

# Post-build exitoso
./agent-deploy.ps1
```

**Watcher de directorio** (skill DO-002):
```
LibrerÃ­a:  expo-background-fetch + expo-file-system
Intervalo: 30 segundos
inbox â†’ processed/{YYYY-MM-DD}/{product_id}/ â†’ archive/
```

**Notificaciones locales** (skill DO-003):
```
STALE_DAILY:           10:00 si hay productos con staleness > 70
REPUBLISH_REMINDER:    +3 dÃ­as tras detectar TTS > 60d
SEASONAL_OPPORTUNITY:  dÃ­a 1 de cada mes
```

**ConvenciÃ³n de commits**:
```
feat(auth):      aÃ±adir pantalla de login con PIN y contraseÃ±a
feat(dashboard): aÃ±adir tarjeta de stock frÃ­o
fix(mmkv):       corregir sobreescritura de firstUploadDate en importaciÃ³n
fix(login):      corregir crash cuando no hay PIN guardado
chore(deps):     actualizar expo a 52.1
refactor(db):    extraer fusionInteligente a mÃ©todo independiente
docs(design):    actualizar DESIGN_SYSTEM.md v4.0 a v4.1
hotfix(auth):    parche urgente en flujo de sesiÃ³n expirada
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE III â€” METODOLOGÃA DE TRABAJO ORQUESTADA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## CICLO DE VIDA DE UNA TAREA

NingÃºn agente puede saltar un estado:

```
[BACKLOG] â†’ [ANÃLISIS] â†’ [EN_PROGRESO] â†’ [REVISIÃ“N] â†’ [DOCS] â†’ [DEPLOY] â†’ [CERRADO]
                                              |
                                         bugs bloqueantes â†’ vuelve a [EN_PROGRESO]
```

## FLUJOS PREDEFINIDOS

### FLUJO-01: Bug simple de UI (MODO SOLO)
```
Bug visual reportado
  â†’ [ORCHESTRATOR]: MODO SOLO â†’ [DEBUGGER]
  â†’ [DEBUGGER]: root cause + fix mÃ­nimo
  â†’ [QA_ENGINEER]: checklist rÃ¡pido (Auth + sagrados)
  â†’ [DEVOPS]: commit fix
```

### FLUJO-02: Feature de UI sin datos nuevos (MODO PAIR)
```
Nuevo componente o pantalla, sin nueva lÃ³gica de datos
  â†’ [ORCHESTRATOR]: MODO PAIR
  â†’ [PRODUCT_OWNER]: criterios de aceptaciÃ³n (PO-003)
  â†’ [UI_SPECIALIST]: implementa con @ResellHub_Dashboard.html como ref
  â†’ [QA_ENGINEER]: checklist completo
  â†’ [LIBRARIAN]: actualiza estructura de archivos (LIB-001)
  â†’ [DEVOPS]: commit + build
```

### FLUJO-03: Feature completa con datos + UI + IA (MODO FULL-TEAM)
```
Feature nueva con lÃ³gica de negocio
  â†’ [ORCHESTRATOR]: MODO FULL-TEAM, identifica skills de @skills.json
  â†’ [PRODUCT_OWNER]: especificaciÃ³n + criterios (PO-001 + PO-003)
  â†’ [ARCHITECT]: diseÃ±o de datos + contrato (ARCH-001/002/003/004)
  â†’ [PROMPT_ENGINEER]: diseÃ±o de prompts IA en paralelo (si aplica)
  â†’ [MIGRATION_MANAGER]: script de migraciÃ³n (si hay schema change)
  â†’ [UI_SPECIALIST]: implementa con contrato de ARCHITECT (UI-001/002/003)
  â†’ [QA_ENGINEER]: checklist completo (QA-001/002/003)
  â†’ [CODE_REVIEWER]: revisiÃ³n arquitectural
  â†’ [SECURITY_OFFICER]: auditorÃ­a si hay cambios en Auth (SEC-001/002)
  â†’ [LIBRARIAN]: docs actualizados + diff (LIB-001/002)
  â†’ [DEVOPS]: build + deploy (DO-001)
```

### FLUJO-04: Hotfix crÃ­tico, Login roto o datos corrompidos (MODO FULL-TEAM URGENTE)
```
Bug crÃ­tico en producciÃ³n
  â†’ [ORCHESTRATOR]: MODO FULL-TEAM URGENTE
  â†’ [DEBUGGER]: diagnÃ³stico inmediato (objetivo: < 5 min)
  â†’ [SECURITY_OFFICER]: evalÃºa riesgo de datos
  â†’ [ARCHITECT] + [MIGRATION_MANAGER]: si hay corrupciÃ³n de MMKV
  â†’ [QA_ENGINEER]: test mÃ­nimo (solo Auth + campos sagrados)
  â†’ [DEVOPS]: hotfix build INMEDIATO
  â†’ [LIBRARIAN]: documenta bug y soluciÃ³n (post-facto)
```

### FLUJO-05: AnÃ¡lisis de negocio puro, sin cÃ³digo (MODO PAIR)
```
Usuario quiere saber quÃ© resubir o cÃ³mo mejorar ventas
  â†’ [ORCHESTRATOR]: MODO PAIR (solo anÃ¡lisis)
  â†’ [GROWTH_HACKER]: TTS, categorÃ­as, estacionalidad (GH-001/002/003)
  â†’ [MARKET_ANALYST]: seÃ±ales externas de Vinted (MA-001/002)
  â†’ [DATA_SCIENTIST]: curvas de decaimiento + predicciones (DS-001/002/003/005)
  â†’ Output: informe de recomendaciones (sin tocar cÃ³digo)
```

### FLUJO-06: Pipeline de nuevo producto detectado (MODO FULL-TEAM AUTO)
```
Nueva carpeta detectada en /inbox
  â†’ [DEVOPS] skill DO-002: directory_watcher detecta carpeta
  â†’ [ARCHITECT] skill ARCH-002: image_pipeline (conv + crop 1px + hash)
  â†’ [PROMPT_ENGINEER]: extrae metadata con Claude Vision
  â†’ [DATA_SCIENTIST] skill DS-002: staleness_score inicializa a 0
  â†’ [UI_SPECIALIST] skill UI-001: muestra pending card en Dashboard
  â†’ [QA_ENGINEER] skill QA-001: LogService.info('PRODUCT_INGESTED', {id, title, brand})
```

### FLUJO-07: Resubida de producto (MODO FULL-TEAM AUTO)
```
Usuario confirma resubida
  â†’ [SECURITY_OFFICER] skill SEC-001: validar lÃ­mites (48h, mÃ¡x 10/dÃ­a)
  â†’ [ARCHITECT] skill ARCH-002: reprocesar imagen (nuevo crop 1px, nuevo hash)
  â†’ [DATA_SCIENTIST] skill DS-004: price_optimizer â†’ precio Ã³ptimo
  â†’ [GROWTH_HACKER] skill GH-001: confirmar timing Ã³ptimo
  â†’ [ARCHITECT] skill ARCH-001: smart_merge (republishCount++, lastPublishedDate=now)
  â†’ [UI_SPECIALIST] skill UI-004: show_copy_card con datos para Vinted
  â†’ [QA_ENGINEER]: LogService.info('PRODUCT_REPUBLISHED', {id, newPrice, republishCount})
```

### FLUJO-08: Marcar producto como vendido (MODO SOLO)
```
Usuario marca vendido
  â†’ [ARCHITECT]: status='sold', soldDate=now
  â†’ [DATA_SCIENTIST] skill DS-001: calcular TTS final
  â†’ [GROWTH_HACKER] skill GH-002: recalibrar umbrales RelÃ¡mpago/Ancla
  â†’ [DATA_SCIENTIST] skill DS-003: actualizar modelo estacionalidad
  â†’ [UI_SPECIALIST]: sold_celebration_animation âœ…
  â†’ [QA_ENGINEER]: LogService.info('PRODUCT_SOLD', {id, tts_days, price, category})
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE IV â€” GUÃA DE INVOCACIÃ“N EN CURSOR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Sintaxis bÃ¡sica
```
@[NOMBRE_AGENTE]: [peticiÃ³n especÃ­fica]
```

## Siempre iniciar con el Orquestador
```
@ORCHESTRATOR: Quiero aÃ±adir una pantalla de "Modo Vacaciones" que pause
las notificaciones cuando el usuario estÃ¡ de viaje. Analiza el impacto,
identifica quÃ© skills de @skills.json aplican y activa los agentes necesarios.
```

## InvocaciÃ³n directa por agente

### DiseÃ±o de datos
```
@ARCHITECT usando skill ARCH-004: Necesito almacenar el "precio de coste"
de cada producto para calcular el margen real. QuÃ© MMKV key creo y cÃ³mo
lo integro sin romper las importaciones existentes?
```

### Feature de UI (con referencia visual)
```
@UI_SPECIALIST usando skill UI-002: Crea la StaleAlertCard tal como
aparece en @ResellHub_Dashboard.html (clase .stale-card).
Props: { title, brand, daysStale, stalenessScore, onRepost, onSkip }
Usa la paleta canÃ³nica y los estados de UI-003.
```

### Optimizar prompt de IA
```
@PROMPT_ENGINEER: Necesito un prompt para Claude Vision que analice
la imagen de una camiseta y devuelva tÃ­tulo, marca, estado y precio
sugerido para Vinted EspaÃ±a. Incluye few-shot con 2 ejemplos reales.
```

### Diagnosticar bug
```
@DEBUGGER: Al importar el JSON de Vinted, firstUploadDate se sobreescribe.
Log adjunto: [ERROR] DB: updateProduct - firstUploadDate overwritten
DatabaseService.js:245
```

### Migrar schema
```
@MIGRATION_MANAGER: El ARCHITECT quiere aÃ±adir el campo "costPrice"
(nÃºmero, nullable) a todos los productos. Genera script con rollback.
```

### AnÃ¡lisis de ventas
```
@GROWTH_HACKER usando skills GH-001 GH-002: Estamos en febrero.
QuÃ© categorÃ­as tienen mayor probabilidad de venta este mes?
Dame recomendaciones de precio para categorÃ­as con TTS > 30 dÃ­as.
```

### Atajo de flujo rÃ¡pido
```
# Bug rÃ¡pido (el Orquestador clasifica):
BUG: [descripciÃ³n] | ARCHIVO: [nombre] | LOGS: [extracto]

# Feature rÃ¡pida:
FEATURE: [quÃ© quiero] | PANTALLA: [dÃ³nde va] | DATOS: [sÃ­/no]

# Solo anÃ¡lisis, sin cÃ³digo:
ANÃLISIS: [quÃ© quiero saber] | DATOS: [fuente]
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE V â€” MAPA DE PROPIEDAD Y RESPONSABILIDADES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Propiedad de archivos

| Archivo | Propietario | Revisores | RestricciÃ³n |
|---------|-------------|-----------|-------------|
| `screens/LoginScreen.jsx` | [SECURITY_OFFICER] | [QA_ENGINEER] | CRITICO: cualquier cambio |
| `App.jsx` | [ARCHITECT] | [SECURITY_OFFICER] | CRITICO: flujo auth y nav |
| `services/DatabaseService.js` | [ARCHITECT] | [QA_ENGINEER] | CRITICO: fusionInteligente() |
| `services/AIService.js` | [PROMPT_ENGINEER] | [ARCHITECT] | Libre |
| `services/LogService.js` | [QA_ENGINEER] | [SECURITY_OFFICER] | CRITICO: niveles de log |
| `services/NotificationService.js` | [GROWTH_HACKER] | [QA_ENGINEER] | Libre |
| `services/ImageProcessingService.js` | [ARCHITECT] | [QA_ENGINEER] | Libre |
| `screens/DashboardScreen.jsx` | [UI_SPECIALIST] | [GROWTH_HACKER] | Libre |
| `screens/SettingsScreen.jsx` | [UI_SPECIALIST] | [ARCHITECT] | Libre |
| `screens/AdvancedStatsScreen.jsx` | [DATA_SCIENTIST] | [UI_SPECIALIST] | Libre |
| `DESIGN_SYSTEM.md` | [LIBRARIAN] | [PRODUCT_OWNER] | CRITICO: tokens y modelo datos |
| `.cursor/rules/resellhub.mdc` | [PRODUCT_OWNER] | [ORCHESTRATOR] | CRITICO: protocolo |
| `skills.json` | [LIBRARIAN] | [ORCHESTRATOR] | CRITICO: skills activas |
| `eas.json` / `app.json` | [DEVOPS] | [ARCHITECT] | CRITICO: config de build |
| `ResellHub_Dashboard.html` | [UI_SPECIALIST] | [PRODUCT_OWNER] | Ref visual â€” no tocar sin consenso |

## MMKV Keys â€” Tabla maestra

| Key | Tipo | Propietario | Protegida | DescripciÃ³n |
|-----|------|-------------|-----------|-------------|
| `products` | JSON Array | [ARCHITECT] | No | Array maestro de productos |
| `app_user_config` | JSON Object | [ARCHITECT] | No | Config global del usuario |
| `app_pin` | String | [SECURITY_OFFICER] | SI | PIN de acceso |
| `app_password` | String | [SECURITY_OFFICER] | SI | ContraseÃ±a de acceso |
| `session_authed_until` | Number ms | [SECURITY_OFFICER] | SI | Timestamp expiraciÃ³n sesiÃ³n |
| `custom_dictionary` | JSON | [ARCHITECT] | No | Diccionario legacy Catâ†’Tags |
| `custom_dictionary_full` | JSON | [ARCHITECT] | No | Diccionario Catâ†’Subcatâ†’Tags |
| `import_log` | JSON Array | [QA_ENGINEER] | No | Ãšltimas 50 importaciones |
| `emergency_backup` | JSON | [SECURITY_OFFICER] | SI | Backup de emergencia |
| `schema_version` | String | [MIGRATION_MANAGER] | SI | VersiÃ³n del schema de datos |


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE VI â€” MÃ“DULO DE AUTENTICACIÃ“N v1.0
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Credenciales por defecto

| Credencial | Valor | MMKV Key |
|-----------|-------|----------|
| PIN | `1234` | `app_pin` |
| ContraseÃ±a | `resellhub` | `app_password` |
| SesiÃ³n | 8 horas | `session_authed_until` |

## IntegraciÃ³n en App.jsx (propietario: [ARCHITECT])
```javascript
import LoginScreen from './screens/LoginScreen';
import { useState, useEffect } from 'react';
import { MMKV } from 'react-native-mmkv';

const sessionStorage = new MMKV();
const SESSION_MS = 8 * 60 * 60 * 1000;

export default function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  useEffect(() => {
    const expiry = sessionStorage.getNumber('session_authed_until');
    if (expiry && Date.now() < expiry) setIsAuthenticated(true);
  }, []);

  const handleAuthenticated = () => {
    sessionStorage.set('session_authed_until', Date.now() + SESSION_MS);
    setIsAuthenticated(true);
  };

  if (!isAuthenticated) return <LoginScreen onAuthenticated={handleAuthenticated} />;

  return (
    <SafeAreaProvider>
      <NavigationContainer>
        <Stack.Navigator screenOptions={{ headerShown: false }}>
          <Stack.Screen name="Main" component={MainTabs} />
          <Stack.Screen name="ProductDetail" component={ProductDetailScreen} />
          <Stack.Screen name="SoldEditDetail" component={SoldEditDetailView} />
        </Stack.Navigator>
      </NavigationContainer>
    </SafeAreaProvider>
  );
}
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE VII â€” ALGORITMOS CANÃ“NICOS DEL MOTOR DE RESUBIDA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```javascript
// ClasificaciÃ³n por velocidad de venta
export const clasificarTTS = (tts) => {
  if (tts == null) return 'PENDIENTE';
  if (tts < 7)    return 'RELAMAGO';  // Verde  â†’ subir precio +10%
  if (tts <= 30)  return 'NORMAL';    // Gris   â†’ mantener precio
  return 'ANCLA';                      // Rojo   â†’ bajar precio -10%
};

// Precio sugerido segÃºn TTS
export const calcularPrecioSugerido = (precio, clasificacion) => {
  const f = { RELAMAGO:1.10, NORMAL:1.00, ANCLA:0.90, PENDIENTE:1.00 };
  return Math.round(precio * (f[clasificacion] ?? 1) * 100) / 100;
};

// Stock FrÃ­o: > 90 dÃ­as sin vender
export const esStockFrio = (createdAt, status) =>
  status !== 'sold' &&
  Math.floor((Date.now() - new Date(createdAt)) / 86400000) > 90;

// Nivel de urgencia de resubida
export const calcularUrgencia = (createdAt) => {
  const dias = Math.floor((Date.now() - new Date(createdAt)) / 86400000);
  if (dias > 90) return { nivel:'CRITICO', color:'#E63946', icon:'ğŸ”´' };
  if (dias > 60) return { nivel:'ALTO',    color:'#FFB800', icon:'ğŸŸ¡' };
  if (dias > 30) return { nivel:'MEDIO',   color:'#5E81AC', icon:'ğŸ”µ' };
  return           { nivel:'BAJO',    color:'#00D9A3', icon:'ğŸŸ¢' };
};

// Curva de decaimiento de interÃ©s â€” skill DS-005
const LAMBDA = {
  'Ropa':0.045,'Calzado':0.055,'TecnologÃ­a':0.080,
  'Libros':0.025,'Hogar':0.035,'Juguetes':0.060, default:0.050,
};
export const calcularDecaimiento = (diasActivo, categoria) =>
  Math.round(Math.exp(-(LAMBDA[categoria]??LAMBDA.default) * diasActivo) * 100);

export const diasHastaOptimo = (categoria, umbral = 30) => {
  const Î» = LAMBDA[categoria] ?? LAMBDA.default;
  return Math.ceil(-Math.log(umbral / 100) / Î»);
};

// TTS en dÃ­as enteros â€” skill DS-001
export const calcTTS = (soldAt, firstUploadDate) =>
  (!soldAt || !firstUploadDate) ? null :
  Math.floor((new Date(soldAt) - new Date(firstUploadDate)) / 86400000);

// DetecciÃ³n de resubida (FusiÃ³n Inteligente) â€” skill ARCH-001
const normalize = (s) => (s ?? '').toLowerCase().trim().replace(/\s+/g,' ');
export const esMismoProducto = (a, b) =>
  normalize(a.title) === normalize(b.title) &&
  normalize(a.brand) === normalize(b.brand);

// Staleness Score 0-100 â€” skill DS-002
export const calcularStalenessScore = ({ diasActivo, views, favorites, catAvgTTS }) => {
  const maxDias = 180;
  const days_factor   = Math.min(diasActivo / maxDias, 1) * 100;
  const view_decay    = views   < 10 ? 80 : views   < 50 ? 40 : 10;
  const fav_decay     = favorites < 2 ? 80 : favorites < 10 ? 40 : 10;
  const cat_deviation = catAvgTTS > 0
    ? Math.min((diasActivo / catAvgTTS) * 50, 100) : 50;
  return Math.round(
    days_factor  * 0.40 +
    view_decay   * 0.25 +
    fav_decay    * 0.20 +
    cat_deviation* 0.15
  );
};
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  PARTE VIII â€” CHECKLIST MAESTRA UNIFICADA PRE-MERGE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  CHECKLIST PRE-MERGE â€” ResellHub v4.1
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[QA_ENGINEER] CÃ“DIGO (QA-001):
  [ ] try/catch en todas las funciones async
  [ ] LogService: nivel correcto + contexto correcto
  [ ] Sin console.log() sueltos
  [ ] memo/useCallback en renders pesados
  [ ] FlatList para listas > 5 items
  [ ] useNativeDriver:true en animaciones

[QA_ENGINEER] IMAGEN (QA-003):
  [ ] Output JPEG verificado (magic bytes FF D8 FF)
  [ ] Dimensiones = originales âˆ’ 2px
  [ ] Hash MD5 â‰  original

[SECURITY_OFFICER] SEGURIDAD (SEC-001/002):
  [ ] app_pin y app_password ausentes en todos los logs
  [ ] Login funciona (PIN: 1234, pass: resellhub)
  [ ] session_authed_until se actualiza en login exitoso
  [ ] LÃ­mites de resubida Vinted respetados (mÃ¡x 10/dÃ­a, 48h mÃ­nimo)

[ARCHITECT] DATOS (ARCH-001/004, QA-002):
  [ ] firstUploadDate, category, title, brand intactos tras cualquier merge
  [ ] esMismoProducto() usado para detectar resubidas
  [ ] Nuevas MMKV keys en DESIGN_SYSTEM.md
  [ ] schema_version actualizado si hay migraciÃ³n

[UI_SPECIALIST] DISEÃ‘O (UI-001/003):
  [ ] Colores de la paleta canÃ³nica (sin hardcode nuevo)
  [ ] Espaciado del grid 8pt
  [ ] activeOpacity={0.7} en TouchableOpacity
  [ ] KeyboardAvoidingView en pantallas con inputs
  [ ] Estados disabled visibles (opacity:0.4)
  [ ] Referencia @ResellHub_Dashboard.html verificada

[CODE_REVIEWER] ARQUITECTURA:
  [ ] Sin lÃ³gica de negocio en componentes UI
  [ ] Sin duplicaciÃ³n > 10 lÃ­neas
  [ ] Hooks sin condicionales
  [ ] useEffect con cleanup si tiene suscripciÃ³n/timer

[LIBRARIAN] DOCS (LIB-001/002):
  [ ] DESIGN_SYSTEM.md actualizado
  [ ] skills.json sincronizado si hay nueva skill
  [ ] Diff mostrado con versiÃ³n incrementada

[DEVOPS] BUILD (DO-001):
  [ ] Sin warnings de Gradle
  [ ] APK instalada y probada en Poco X7 Pro fÃ­sico
  [ ] Commit message sigue la convenciÃ³n canÃ³nica
  [ ] agent-deploy.ps1 ejecutado si aplica

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  RESULTADO: APROBADO / BLOQUEADO (razones)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  METADATOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#  VERSIÃ“N:             4.1
#  FECHA:               Febrero 2026
#  AGENTES TOTALES:     13
#  AGENTES v4.0:        [ORCHESTRATOR], [DEBUGGER], [CODE_REVIEWER],
#                       [PROMPT_ENGINEER], [MIGRATION_MANAGER]
#  FLUJOS PREDEFINIDOS: 8  (FLUJO-01 a FLUJO-08)
#  MODOS DE TRABAJO:    3  (SOLO, PAIR, FULL-TEAM)
#  SKILLS REF:          @skills.json v3.0 (29 skills, 9 agentes)
#  DISEÃ‘O REF:          @ResellHub_Dashboard.html
#
#  PENDIENTE v4.2:
#    - Settings â†’ Seguridad: cambio de PIN y contraseÃ±a desde la app
#    - Bloqueo de acceso tras 5 intentos fallidos (30 segundos)
#    - SesiÃ³n configurable (4h / 8h / 24h / nunca)
#    - IntegraciÃ³n skills.json con ORCHESTRATOR auto-lookup
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
